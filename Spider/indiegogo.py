# encoding: utf-8
"""
@author: jason
@contact: scnu_wang@163.com

"""

import requests
import json
#请求头里面要添加Cookie
headers = {'Accept': 'application/json, text/plain, */*',
           'Accept-Encoding': 'gzip, deflate, sdch, br',
           'Accept-Language': 'zh-CN,zh;q=0.8',
           'Connection': 'keep-alive', 'Host': 'www.indiegogo.com',
           'If-None-Match': 'W/"fa7571dc6b68ed2ad6b530ca10a18ef3"',
           'Referer': 'https://www.indiegogo.com/explore/home',
           'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.81 Safari/537.36',
            'Cookie':'ki_t=1482987544992%3B1487728858942%3B1487729104639%3B4%3B16; ki_r=; D_SID=113.104.195.55:YisvIcHF4Z24s3TB2TKbitxWEwrmGlyymljvxklDswE; __ar_v4=MNA52ZMPS5A5HHGLKMZP3O%3A20170602%3A3%7CZIENZZYANBHC5MQ4WYNKZI%3A20170602%3A3%7C6RP73TXU3VCT7KLJC3P7EZ%3A20170602%3A3; __stripe_mid=35ce441a-7019-4221-b482-b0cba67f7fd4; romref=sch-baid; romref_referer_host=www.baidu.com; D_IID=02B91A75-51CD-3F94-A882-07B72A5961C2; D_UID=8506F25A-0F30-31AC-81E7-2864983C64A4; D_ZID=FDDDFB6A-67FA-340D-9C89-564B5A0B9899; D_ZUID=5D0201DE-2FF3-3A22-AD4E-8F28FE310CF0; D_HID=2FCF09D9-15AF-3626-BC88-5C189ABE314C; _ga=GA1.2.378922805.1482987529; _gid=GA1.2.772188293.1496800270; _ceg.s=or7ggq; _ceg.u=or7ggq; __hstc=223492548.37066d182471c31df2df71226efcf1aa.1482987568028.1496806912327.1496885823487.12; __hssrc=1; __hssc=223492548.1.1496885823487; hubspotutk=37066d182471c31df2df71226efcf1aa; locale=en; cohort=www.baidu.com%7Csch-baid%7Cshr-pica%7Csch-baid%7Cshr-pica%7Csch-baid; visitor_id=bba58762b2348bf353961ae7353f1e7ab5ff697484ba0a55993771e32402d354; analytics_session_id=2cab9c7316a54d91e73058b25c9e12748d7b3fda0ea06d63e02fb536b212e3d6; recent_project_ids=2001745%262132365%262115568%262107867%261905844%261637253%262115621%261931378%262063864%261787929%262024430%261978687%261993728%262016897%262023232%261994449%262017684%262022194%261319420%261625355; _session_id=742dc34425f25f0f10f5962f23becc4f'
           }
#获取Tech & Innovation 下的所有的产品列表
flag = 1
pg_num = 0
urls = ([])
while flag == 1:
    pg_num = pg_num + 1
    payload = {'pg_num': pg_num}
    r = requests.get("https://www.indiegogo.com/private_api/explore?filter_category=Tech+%26+Innovation&filter_funding=&filter_percent_funded=&filter_quick=popular_all&filter_status=&per_page=100",headers=headers,params=payload)

    #解析单页的产品数据列表
    #先获取产品总的信息，再获取产品支持项的信息
    productlist = r.json()['campaigns']
    for product in productlist:
        print(product['id'])#产品编号
        print(product['title'])#产品名称
        print(product['currency_code'])#货币编号
        print(product['balance'])#已筹金额
        print(product['in_forever_funding'])#是否是永久众筹
        print(product['url'])#产品的地址：www.indiegogo.com/url['url']
        print(product['compressed_image_url'])#封面图片地址
        print(product['amt_time_left'])#剩余天数
        print(product['collected_percentage'])#完成度
        itemUrl = "https://www.indiegogo.com/private_api/campaigns/%s/perks" % (product['id'])#构建获取产品支持项的链接
        urls.append(itemUrl)
        print("====================================")
    if len(productlist) == 0:
        break

# print(len(urls))
#支持项处理
for url in urls:
    print(url)
    items = requests.get(url,headers=headers).text
    #{"response":[{"id":4095003,"amount":295,"label":"The Tracy 2-in-1 Bag","description":"As one of our early supporters, get your Tracy 2-in-1 bag at a 25% discount off of retail (Retail: $395).  You'll receive one stylish genuine leather bag that includes both a 3-way convertible tote and one black zip-off clutch.  You can wear them separately as two bags, or together as one for all your occasions.","estimated_delivery_date":"2017-11-15T00:00:00-08:00","featured":true,"non_tax_deductible_amount":null,"perk_image_public_id":null,"use_non_tax_deductible_amount":false,"retail_amount":null,"shipping_address_required":true,"campaign_slug":"tara-co-fashion-meets-function-convertible-bag-women-backpack--2","number_claimed":34,"number_available":null,"shipping_fees":[{"country_code":"US","fee":18},{"country_code":"CA","fee":30}],"available":true,"top_perk":true,"shipping_now":false,"pre_orderable":false,"secret_perk_path":null,"secret_token":null,"perk_item_links":[{"quantity":1,"perk_item_id":165684,"perk_item":{"id":165684,"name":"\"The Tracy\" 2-in-1 bag","associated_with_claimed_perk":true}}],"status":"STPK_VSBL","amount_in_usd":null,"choices":null,"referenced_in_an_order":true,"secret":false,"shipping":{"id":659728,"fees":{"US":18,"CA":30},"is_free_everywhere":false}},{"id":4094998,"amount":25,"label":"Tara Supporter Headphone Case","description":"Love our mission of reimagining products for real women, but not ready to buy a bag yet?  Donate $25 and we'll send you a genuine leather Tara Supporter headphone case to keep your headphones organized and tidy.","estimated_delivery_date":"2017-11-15T00:00:00-08:00","featured":false,"non_tax_deductible_amount":null,"perk_image_public_id":null,"use_non_tax_deductible_amount":false,"retail_amount":null,"shipping_address_required":true,"campaign_slug":"tara-co-fashion-meets-function-convertible-bag-women-backpack--2","number_claimed":12,"number_available":null,"shipping_fees":[{"country_code":"US","fee":3},{"country_code":"CA","fee":5}],"available":true,"top_perk":null,"shipping_now":false,"pre_orderable":false,"secret_perk_path":null,"secret_token":null,"perk_item_links":[{"quantity":1,"perk_item_id":165678,"perk_item":{"id":165678,"name":"Headphone Case","associated_with_claimed_perk":true}}],"status":"STPK_VSBL","amount_in_usd":null,"choices":null,"referenced_in_an_order":true,"secret":false,"shipping":{"id":659725,"fees":{"US":3,"CA":5},"is_free_everywhere":false}},{"id":4108838,"amount":89,"label":"The Clutch","description":"You want a genuine soft leather clutch to carry around your basics.  Fits your phone and more.  YOU'LL GET: 1 Clutch in your choice of black, lava red, or cerulean teal.  Clutch comes with: 1) Inside zippered pocket, 2) 20\" Removable Strap, 3) Royal purple water-resistant nylon lining, 4) Ability to zip on The Tracy if you decide to buy later.","estimated_delivery_date":"2017-11-15T00:00:00-08:00","featured":false,"non_tax_deductible_amount":null,"perk_image_public_id":null,"use_non_tax_deductible_amount":false,"retail_amount":null,"shipping_address_required":true,"campaign_slug":"tara-co-fashion-meets-function-convertible-bag-women-backpack--2","number_claimed":3,"number_available":100,"shipping_fees":[{"country_code":"US","fee":7},{"country_code":"CA","fee":10}],"available":true,"top_perk":null,"shipping_now":false,"pre_orderable":false,"secret_perk_path":null,"secret_token":null,"perk_item_links":[{"quantity":1,"perk_item_id":176993,"perk_item":{"id":176993,"name":"Clutch","associated_with_claimed_perk":true}}],"status":"STPK_VSBL","amount_in_usd":null,"choices":null,"referenced_in_an_order":true,"secret":false,"shipping":{"id":665450,"fees":{"US":7,"CA":10},"is_free_everywhere":false}},{"id":4095020,"amount":370,"label":"The Tracy bag + 1 Color Clutch","description":"You're a fashionista and want options for your Tracy bag.  Receive a 25% discount on both your Tracy 2-in-1 bag, and an additional colored clutch (Retail: $99).  Switch out your flap to the color of your choice, or use your clutch separately as its own standalone piece with pocket and detachable strap.","estimated_delivery_date":"2017-11-15T00:00:00-08:00","featured":false,"non_tax_deductible_amount":null,"perk_image_public_id":null,"use_non_tax_deductible_amount":false,"retail_amount":null,"shipping_address_required":true,"campaign_slug":"tara-co-fashion-meets-function-convertible-bag-women-backpack--2","number_claimed":12,"number_available":null,"shipping_fees":[{"country_code":"US","fee":20},{"country_code":"CA","fee":30}],"available":true,"top_perk":false,"shipping_now":false,"pre_orderable":false,"secret_perk_path":null,"secret_token":null,"perk_item_links":[{"quantity":1,"perk_item_id":165684,"perk_item":{"id":165684,"name":"\"The Tracy\" 2-in-1 bag","associated_with_claimed_perk":true}},{"quantity":1,"perk_item_id":165699,"perk_item":{"id":165699,"name":"Colored Clutch","associated_with_claimed_perk":true}}],"status":"STPK_VSBL","amount_in_usd":null,"choices":null,"referenced_in_an_order":true,"secret":false,"shipping":{"id":659735,"fees":{"US":20,"CA":30},"is_free_everywhere":false}},{"id":4095028,"amount":435,"label":"Tracy Bag + 2 Colored Clutches","description":"Trendsetter. Get the full set and accessorize for every occasion. As an early backer, you get The Tracy 2-in-1 bag and two additional colored clutches. At this level, you're receiving a 25% discount on your Tracy bag, and 30% off both your colored clutches. Match your Tracy bag to your outfit every day or take your choice of clutch out on the town.","estimated_delivery_date":"2017-11-15T00:00:00-08:00","featured":false,"non_tax_deductible_amount":null,"perk_image_public_id":null,"use_non_tax_deductible_amount":false,"retail_amount":null,"shipping_address_required":true,"campaign_slug":"tara-co-fashion-meets-function-convertible-bag-women-backpack--2","number_claimed":2,"number_available":null,"shipping_fees":[{"country_code":"US","fee":22},{"country_code":"CA","fee":32}],"available":true,"top_perk":null,"shipping_now":false,"pre_orderable":false,"secret_perk_path":null,"secret_token":null,"perk_item_links":[{"quantity":1,"perk_item_id":165684,"perk_item":{"id":165684,"name":"\"The Tracy\" 2-in-1 bag","associated_with_claimed_perk":true}},{"quantity":2,"perk_item_id":165699,"perk_item":{"id":165699,"name":"Colored Clutch","associated_with_claimed_perk":true}}],"status":"STPK_VSBL","amount_in_usd":null,"choices":null,"referenced_in_an_order":true,"secret":false,"shipping":{"id":659740,"fees":{"US":22,"CA":32},"is_free_everywhere":false}},{"id":4095036,"amount":590,"label":"The Friend Pack - 2 Tracy Bags","description":"Sharing is caring.  Buy one for you and one for a friend at our limited pre-order discount (25% off of retail) and support the Tara brand.  Get 2 full bags which each include a black 3-way convertible tote and black clutch.","estimated_delivery_date":"2017-11-15T00:00:00-08:00","featured":false,"non_tax_deductible_amount":null,"perk_image_public_id":null,"use_non_tax_deductible_amount":false,"retail_amount":null,"shipping_address_required":true,"campaign_slug":"tara-co-fashion-meets-function-convertible-bag-women-backpack--2","number_claimed":5,"number_available":null,"shipping_fees":[{"country_code":"US","fee":29},{"country_code":"CA","fee":39}],"available":true,"top_perk":null,"shipping_now":false,"pre_orderable":false,"secret_perk_path":null,"secret_token":null,"perk_item_links":[{"quantity":2,"perk_item_id":165684,"perk_item":{"id":165684,"name":"\"The Tracy\" 2-in-1 bag","associated_with_claimed_perk":true}}],"status":"STPK_VSBL","amount_in_usd":null,"choices":null,"referenced_in_an_order":true,"secret":false,"shipping":{"id":659745,"fees":{"US":29,"CA":39},"is_free_everywhere":false}},{"id":4095041,"amount":870,"label":"Tara Goddess  - 2 Full Sets","description":"You want it all.  You're our biggest supporter and want to outfit yourself and a friend with all of our launch products.  You'll receive two full sets of our launch products -- two 2-in-1 Tracy bags (25% discount) and four colored clutches of your choice (30% discount).  You'll save over $300 off of retail.  You're a rockstar!","estimated_delivery_date":"2017-11-15T00:00:00-08:00","featured":false,"non_tax_deductible_amount":null,"perk_image_public_id":null,"use_non_tax_deductible_amount":false,"retail_amount":null,"shipping_address_required":true,"campaign_slug":"tara-co-fashion-meets-function-convertible-bag-women-backpack--2","number_claimed":5,"number_available":null,"shipping_fees":[{"country_code":"US","fee":39},{"country_code":"CA","fee":50}],"available":true,"top_perk":null,"shipping_now":false,"pre_orderable":false,"secret_perk_path":null,"secret_token":null,"perk_item_links":[{"quantity":2,"perk_item_id":165684,"perk_item":{"id":165684,"name":"\"The Tracy\" 2-in-1 bag","associated_with_claimed_perk":true}},{"quantity":4,"perk_item_id":165699,"perk_item":{"id":165699,"name":"Colored Clutch","associated_with_claimed_perk":true}}],"status":"STPK_VSBL","amount_in_usd":null,"choices":null,"referenced_in_an_order":true,"secret":false,"shipping":{"id":659748,"fees":{"US":39,"CA":50},"is_free_everywhere":false}}],"count":7,"secret_perk_status":null}
    itemlist = json.loads(items)['response']
    for item in itemlist:
        print(item['id'])#itemid
        print(item['amount'])#产品项价格
        print(item['label'])#产品项标签
        print(item['description'])#产品项描述
        print(item['number_available'])#产品项期望支持人数
        print(item['number_claimed'])#产品项实际支持人数
        print("====================================")